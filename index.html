<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Free Flexiload</title>
    
    <!-- Telegram SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Ad Network SDK (FIXED) -->
    <script src='//libtl.com/sdk.js' data-zone='10265360' data-sdk='show_10265360'></script>
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        /* Base Ultra Styles */
        :root {
            --primary: #0088cc;
            --secondary: #00bcd4;
            --gold: #ffd700;
            --bg-dark: #0f0f11;
            --card-bg: rgba(30, 30, 35, 0.7);
            --glass: rgba(255, 255, 255, 0.05);
            --text-gray: #a1a1aa;
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; padding: 0;
            font-family: 'Poppins', sans-serif;
            background: radial-gradient(circle at top left, #1a2a3a, var(--bg-dark));
            color: white;
            height: 100vh; overflow: hidden; user-select: none;
        }

        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999;
            display: flex; justify-content: center; align-items: center;
            flex-direction: column; transition: opacity 0.5s;
        }
        .spinner {
            width: 50px; height: 50px;
            border: 5px solid rgba(255,255,255,0.1);
            border-top: 5px solid var(--primary);
            border-radius: 50%; animation: spin 1s linear infinite;
        }

        .container {
            padding: 20px; height: calc(100vh - 70px);
            overflow-y: auto; padding-bottom: 80px;
        }

        .app-brand {
            text-align: center; font-size: 20px; font-weight: 700; margin-bottom: 20px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-transform: uppercase; letter-spacing: 2px;
        }

        /* Profile & Status */
        .profile-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0));
            backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px; padding: 20px; display: flex; align-items: center; gap: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); margin-bottom: 25px; position: relative; overflow: hidden;
        }
        .status-badge {
            position: absolute; top: 10px; right: 10px;
            font-size: 10px; padding: 4px 8px; border-radius: 10px;
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #ccc;
        }
        .status-badge.pro {
            background: rgba(255, 215, 0, 0.2); border-color: var(--gold);
            color: var(--gold); box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
            animation: glow 2s infinite alternate;
        }
        .avatar {
            width: 60px; height: 60px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            font-size: 24px; font-weight: bold;
        }
        .info h2 { margin: 0; font-size: 18px; }
        .info p { margin: 2px 0 0; font-size: 12px; color: var(--text-gray); }

        .balance-card { text-align: center; margin-bottom: 30px; }
        .balance-amount { font-size: 42px; font-weight: 700; background: linear-gradient(to right, #fff, #bbb); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 5px 0; }
        .balance-title { font-size: 14px; color: var(--text-gray); text-transform: uppercase; letter-spacing: 1px; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .card {
            background: var(--card-bg); padding: 20px; border-radius: 18px; text-align: center;
            transition: transform 0.2s; border: 1px solid rgba(255,255,255,0.05);
        }
        .card:active { transform: scale(0.96); background: rgba(255,255,255,0.1); }
        .card i { font-size: 28px; margin-bottom: 10px; color: var(--secondary); }
        .card h4 { margin: 0; font-weight: 500; }

        .section { display: none; animation: fadeIn 0.3s ease; }
        .section.active { display: block; }

        .input-group { margin-top: 15px; text-align: left; }
        input {
            width: 100%; padding: 15px; background: rgba(0,0,0,0.3);
            border: 1px solid #333; border-radius: 12px; color: white; font-size: 16px; outline: none;
        }
        input:focus { border-color: var(--primary); }
        
        .btn-main {
            width: 100%; padding: 15px; border: none; border-radius: 12px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            color: white; font-weight: 600; font-size: 16px; margin-top: 15px; cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 188, 212, 0.4);
        }

        /* Progress Bar */
        .progress-container { width: 100%; background: rgba(255,255,255,0.1); height: 10px; border-radius: 5px; margin: 15px 0; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary), var(--gold)); width: 0%; transition: width 0.5s ease; box-shadow: 0 0 10px var(--primary); }
        .progress-text { display: flex; justify-content: space-between; font-size: 12px; color: #aaa; margin-bottom: 5px; }

        /* Refer Box */
        .refer-box { background: rgba(255, 255, 255, 0.03); border: 2px dashed rgba(255, 255, 255, 0.2); border-radius: 15px; padding: 20px; margin-bottom: 20px; position: relative; }
        .refer-code { font-size: 32px; font-weight: bold; color: var(--secondary); letter-spacing: 2px; margin: 10px 0; text-shadow: 0 0 10px rgba(0, 188, 212, 0.3); }
        .hidden-input { position: absolute; opacity: 0; pointer-events: none; }

        /* History Styles (New) */
        .history-list { margin-top: 25px; }
        .history-header { font-size: 16px; font-weight: 600; margin-bottom: 15px; border-left: 3px solid var(--primary); padding-left: 10px; }
        .history-item {
            background: rgba(30, 30, 35, 0.8); border: 1px solid rgba(255,255,255,0.05);
            padding: 12px 15px; border-radius: 12px; margin-bottom: 10px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .history-left h5 { margin: 0 0 5px 0; font-size: 14px; color: #fff; }
        .history-left p { margin: 0; font-size: 10px; color: #888; }
        .history-right { text-align: right; }
        .history-amount { font-weight: bold; color: var(--secondary); font-size: 14px; }
        .history-status { font-size: 10px; padding: 2px 6px; border-radius: 4px; background: rgba(255,255,255,0.1); display: inline-block; margin-top: 4px; }
        .status-pending { color: #ffc107; background: rgba(255, 193, 7, 0.15); }

        /* Bottom Nav */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(20, 20, 25, 0.9); backdrop-filter: blur(20px);
            display: flex; justify-content: space-around; padding: 15px 0;
            border-top: 1px solid rgba(255,255,255,0.05); z-index: 100;
        }
        .nav-item { color: #666; text-align: center; font-size: 10px; cursor: pointer; transition: color 0.3s; }
        .nav-item i { font-size: 20px; display: block; margin-bottom: 4px; }
        .nav-item.active { color: var(--primary); }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes glow { from { opacity: 0.8; box-shadow: 0 0 5px var(--gold); } to { opacity: 1; box-shadow: 0 0 20px var(--gold); } }
    </style>
</head>
<body>

    <div id="loader">
        <div class="spinner"></div>
        <p style="margin-top: 15px; font-size: 14px; font-weight: bold; letter-spacing: 1px;">FREE FLEXILOAD ‚ö°</p>
    </div>

    <div class="container">
        
        <!-- HOME TAB -->
        <div id="home" class="section active">
            <div class="app-brand">Free Flexiload ‚ö°</div>
            <div class="profile-card">
                <div id="statusBadge" class="status-badge">BASIC PLAN</div>
                <div class="avatar" id="avatarLetter">U</div>
                <div class="info">
                    <h2 id="fullName">User Name</h2>
                    <p>ID: <span id="userId">000000</span></p>
                </div>
            </div>
            <div class="balance-card">
                <div class="balance-title">Flexiload Balance</div>
                <div class="balance-amount">‡ß≥<span id="balance">0.00</span></div>
            </div>
            <div class="grid">
                <div class="card" onclick="switchTab('tasks')"><i class="fa-solid fa-play"></i><h4>Watch Ads</h4></div>
                <div class="card" onclick="switchTab('refer')"><i class="fa-solid fa-user-plus"></i><h4>Invite</h4></div>
                <div class="card" onclick="switchTab('wallet')"><i class="fa-solid fa-mobile-screen-button"></i><h4>Flexiload</h4></div>
                <div class="card" onclick="window.open('https://t.me/YourChannel', '_blank')"><i class="fa-brands fa-telegram"></i><h4>Support</h4></div>
            </div>
        </div>

        <!-- TASKS TAB -->
        <div id="tasks" class="section">
            <h2 style="margin-bottom: 5px;">Earn Balance</h2>
            <p style="color: #888; font-size: 13px;" id="adRateText">Watch ads to get Free Flexiload.</p>
            <div class="card" style="display: flex; align-items: center; gap: 15px; margin-top: 20px; text-align: left;">
                <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 10px;">
                    <i class="fa-solid fa-gift" style="color: gold; margin: 0;"></i>
                </div>
                <div style="flex-grow: 1;">
                    <h4 style="margin: 0;">Premium Ad</h4>
                    <span style="font-size: 12px; color: #aaa;" id="adRateDisplay">+‡ß≥0.50 / View</span>
                </div>
                <button class="btn-main" style="width: auto; padding: 8px 20px; margin: 0; font-size: 12px;" onclick="showAd()">VIEW</button>
            </div>
        </div>

        <!-- REFER TAB -->
        <div id="refer" class="section">
            <div style="text-align: center; margin-top: 20px;">
                <i class="fa-solid fa-users" style="font-size: 50px; color: var(--primary); margin-bottom: 20px;"></i>
                <h2>Invite Friends</h2>
                <p style="color: #aaa; font-size: 13px;">Reach <b>20 Referrals</b> to unlock <b>ULTRA PRO</b> mode (2x Income).</p>
                
                <div style="margin: 20px 0; text-align: left;">
                    <div class="progress-text"><span>Progress</span><span id="progressCount">0 / 20</span></div>
                    <div class="progress-container"><div class="progress-fill" id="progressBar"></div></div>
                    <p style="font-size: 11px; color: #666; text-align: center;" id="progressMsg">Keep inviting!</p>
                </div>

                <div class="refer-box" onclick="copyRef()">
                    <span style="color: #888; font-size: 12px; text-transform: uppercase;">Your Refer Code</span>
                    <div class="refer-code" id="displayRefCode">...</div>
                    <span style="font-size: 11px; color: var(--primary);">Tap Code to Copy Link</span>
                </div>
                <input type="text" id="refLink" class="hidden-input" readonly>
                <div class="grid">
                    <button class="btn-main" style="margin-top: 0; background: #333;" onclick="copyRef()"><i class="fa-regular fa-copy"></i> Copy</button>
                    <button class="btn-main" style="margin-top: 0;" onclick="inviteFriend()"><i class="fa-solid fa-share"></i> Share</button>
                </div>
            </div>
        </div>

        <!-- WALLET TAB (With History) -->
        <div id="wallet" class="section">
            <h2>Get Flexiload</h2>
            <div class="balance-card">
                <div class="balance-amount">‡ß≥<span id="walletBalance">0.00</span></div>
            </div>

            <div class="input-group">
                <label style="font-size: 12px; color: #888; margin-left: 5px;">Mobile Number</label>
                <input type="text" id="paymentMethod" placeholder="017xxxxxxxx">
            </div>
            <div class="input-group">
                <label style="font-size: 12px; color: #888; margin-left: 5px;">Amount</label>
                <input type="number" id="withdrawAmount" placeholder="Min: 1">
            </div>
            <button class="btn-main" onclick="requestWithdraw()">Recharge Now</button>

            <!-- HISTORY SECTION -->
            <div class="history-list">
                <div class="history-header">Recent History</div>
                <div id="historyContainer">
                    <!-- History Items will load here -->
                    <p style="text-align: center; font-size: 12px; color: #666;">No history found.</p>
                </div>
            </div>
        </div>

    </div>

    <!-- Bottom Nav -->
    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('home')"><i class="fa-solid fa-house"></i> Home</div>
        <div class="nav-item" onclick="switchTab('tasks')"><i class="fa-solid fa-layer-group"></i> Tasks</div>
        <div class="nav-item" onclick="switchTab('wallet')"><i class="fa-solid fa-mobile-screen-button"></i> Load</div>
        <div class="nav-item" onclick="switchTab('refer')"><i class="fa-solid fa-user-group"></i> Refer</div>
    </div>

    <script>
        // ==========================================
        // ‚ö†Ô∏è ADMIN SETTINGS (‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®)
        // ==========================================
        const BOT_TOKEN = "8551822175:AAEL_HRPcoecnQ-bAxudV13D-sA2_IOkjkU"; // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶ü‡ßá‡¶∞ ‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶¶‡¶ø‡¶®
        const ADMIN_ID = "8551822175";   // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶¶‡¶ø‡¶®
        // ==========================================

        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        // Loader
        setTimeout(() => {
            document.getElementById('loader').style.opacity = '0';
            setTimeout(() => { document.getElementById('loader').style.display = 'none'; }, 500);
        }, 1500);

        let user = tg.initDataUnsafe.user || { first_name: "Test User", id: 123456, username: "tester" };
        let balance = parseFloat(localStorage.getItem('balance_' + user.id)) || 0;
        let referrals = parseInt(localStorage.getItem('ref_' + user.id)) || 0;

        // Init UI
        document.getElementById('fullName').innerText = user.first_name;
        document.getElementById('avatarLetter').innerText = user.first_name.charAt(0);
        document.getElementById('userId').innerText = user.id;
        document.getElementById('displayRefCode').innerText = user.id;
        document.getElementById('refLink').value = `https://t.me/Freeflexiload_bot?start=ref_${user.id}`;
        
        updateBalanceUI();
        updateProStatus();
        renderHistory(); 

        function switchTab(tabId) {
            tg.HapticFeedback.impactOccurred('light');
            document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            
            if(tabId === 'home') document.querySelectorAll('.nav-item')[0].classList.add('active');
            if(tabId === 'tasks') document.querySelectorAll('.nav-item')[1].classList.add('active');
            if(tabId === 'wallet') document.querySelectorAll('.nav-item')[2].classList.add('active');
            if(tabId === 'refer') document.querySelectorAll('.nav-item')[3].classList.add('active');
        }

        function updateProStatus() {
            let isPro = referrals >= 20;
            let target = 20;
            let percent = (referrals / target) * 100;
            if(percent > 100) percent = 100;

            document.getElementById('progressBar').style.width = percent + "%";
            document.getElementById('progressCount').innerText = `${referrals} / ${target}`;

            let badge = document.getElementById('statusBadge');
            let msg = document.getElementById('progressMsg');
            let rateDisplay = document.getElementById('adRateDisplay');

            if (isPro) {
                badge.innerText = "ULTRA PRO ‚ö°";
                badge.classList.add('pro');
                msg.innerText = "Congratulations! Ultra Pro Active (2x Income)";
                msg.style.color = "gold";
                rateDisplay.innerText = "+‡ß≥1.00 / View (PRO)";
                rateDisplay.style.color = "gold";
            } else {
                badge.innerText = "BASIC PLAN";
                badge.classList.remove('pro');
                msg.innerText = `${target - referrals} more invites to unlock 2x Income!`;
                rateDisplay.innerText = "+‡ß≥0.50 / View";
            }
        }

        function updateBalanceUI() {
            document.getElementById('balance').innerText = balance.toFixed(2);
            document.getElementById('walletBalance').innerText = balance.toFixed(2);
            updateProStatus();
        }

        // Show Ad Logic (Using Correct SDK)
        function showAd() {
            tg.HapticFeedback.impactOccurred('medium');
            let reward = (referrals >= 20) ? 1.00 : 0.50;

            // SDK: 10265360
            if (typeof show_10265360 === 'function') {
                show_10265360().then(() => {
                    tg.HapticFeedback.notificationOccurred('success');
                    balance += reward;
                    localStorage.setItem('balance_' + user.id, balance);
                    updateBalanceUI();
                    let msg = (referrals >= 20) ? `Ultra Pro Bonus! Added ‡ß≥${reward.toFixed(2)}` : `Balance Added: ‡ß≥${reward.toFixed(2)}`;
                    tg.showAlert(msg);
                }).catch(e => tg.showAlert("Ad failed to load."));
            } else {
                tg.showAlert(`Testing Mode: Added ‡ß≥${reward.toFixed(2)}`);
                balance += reward;
                localStorage.setItem('balance_' + user.id, balance);
                updateBalanceUI();
            }
        }

        function copyRef() {
            let copyText = document.getElementById("refLink");
            copyText.select();
            copyText.setSelectionRange(0, 99999);
            document.execCommand("copy");
            tg.HapticFeedback.notificationOccurred('success');
            tg.showPopup({ title: 'Copied!', message: 'Share link to unlock Ultra Pro!', buttons: [{type: 'ok'}] });
        }

        function inviteFriend() {
            let link = document.getElementById('refLink').value;
            let text = `üéÅ Free Flexiload! Code: ${user.id}\n\nJoin:`;
            let url = `https://t.me/share/url?url=${encodeURIComponent(link)}&text=${encodeURIComponent(text)}`;
            tg.openTelegramLink(url);
        }

        function renderHistory() {
            let history = JSON.parse(localStorage.getItem('history_' + user.id) || "[]");
            let container = document.getElementById('historyContainer');
            
            if(history.length === 0) {
                container.innerHTML = '<p style="text-align: center; font-size: 12px; color: #666;">No history found.</p>';
                return;
            }

            container.innerHTML = "";
            history.forEach(item => {
                let html = `
                <div class="history-item">
                    <div class="history-left">
                        <h5>Flexiload Request</h5>
                        <p>${item.date} ‚Ä¢ ${item.number}</p>
                    </div>
                    <div class="history-right">
                        <div class="history-amount">‡ß≥${item.amount}</div>
                        <div class="history-status status-pending">${item.status}</div>
                    </div>
                </div>`;
                container.innerHTML += html;
            });
        }

        // üî• Withdraw Request (Sends to Admin)
        function requestWithdraw() {
            tg.HapticFeedback.impactOccurred('heavy');
            let amount = parseFloat(document.getElementById('withdrawAmount').value);
            let method = document.getElementById('paymentMethod').value;

            if (amount > balance) return tg.showAlert("Insufficient balance!");
            if (amount < 1) return tg.showAlert("Min amount is ‡ß≥1");
            if (!method) return tg.showAlert("Enter number");

            // Admin Message Format (Pro Style)
            let msgText = `‚ö° *WITHDRAW REQUEST* ‚ö°\n\nüë§ *User:* ${user.first_name}\nüÜî *ID:* \`${user.id}\`\nüí∞ *Amount:* ‡ß≥${amount}\nüì± *Number:* \`${method}\`\nüìä *Plan:* ${referrals >= 20 ? 'ULTRA PRO' : 'BASIC'}`;

            if(confirm(`Confirm Flexiload of ‡ß≥${amount}?`)) {
                // Update Local Balance
                balance -= amount;
                localStorage.setItem('balance_' + user.id, balance);
                updateBalanceUI();

                // Save to History
                let history = JSON.parse(localStorage.getItem('history_' + user.id) || "[]");
                history.unshift({
                    amount: amount,
                    number: method,
                    date: new Date().toLocaleString(),
                    status: 'Pending'
                });
                localStorage.setItem('history_' + user.id, JSON.stringify(history));
                renderHistory();

                // Send to Admin via Telegram API
                fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${ADMIN_ID}&text=${encodeURIComponent(msgText)}&parse_mode=Markdown`)
                .then(res => {
                    if(res.ok) {
                        tg.showPopup({ title: 'Success', message: 'Request Sent to Admin!', buttons: [{type: 'ok'}] });
                    } else {
                        tg.showAlert("Network Error! Check Bot Token.");
                    }
                })
                .catch(err => {
                    console.error(err);
                    tg.showAlert("Request Failed!");
                });
                
                document.getElementById('withdrawAmount').value = "";
            }
        }
    </script>
</body>
</html>